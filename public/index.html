<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./code.css">
    <title>Arbre de choix</title>
</head>
<body>
<div class="ajustementright">
<div id="fileExplorer" class="menu"></div>
<pre id="fileContent" class="display"></pre>
</div><!-- 
Test  -->
<script>
function loadFilesAndFolders(data, parentElement, currentPath, isOpen) {
    var ul = document.createElement('ul');
    parentElement.appendChild(ul);

    data.forEach(item => {
        var li = document.createElement('li');
        const itemPath = currentPath ? `${currentPath}/${item.name}` : item.name;

        if (item.type === 'dossier') {
            li.innerHTML = `<span class="icon">üìÅ</span><span>${item.name}</span>`;
            li.classList.add('folder');

            // Ajoutez un attribut isOpen √† chaque √©l√©ment pour suivre son √©tat d'ouverture ou de fermeture
            li.isOpen = isOpen;

            li.addEventListener('click', function(e) {
                e.stopPropagation();
                this.isOpen = !this.isOpen; // Inversez l'√©tat isOpen lors du clic
                this.querySelector('.nested').classList.toggle('active');
                this.querySelector('.icon').textContent = this.querySelector('.nested').classList.contains('active') ? 'üìÇ' : 'üìÅ';
            });
        }else if (item.type === 'fichier') {
    const link = document.createElement('a');
    link.href = '#';
    link.textContent = item.name;
   
    link.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation(); // Emp√™che la propagation de l'√©v√©nement de clic aux √©l√©ments parents pour ne pas que le folder se ferme apres le click sur un fichier
        loadFileContent(itemPath);
    });
    li.appendChild(link);
}

        ul.appendChild(li);

        if (item.contenu && item.contenu.length > 0) {
            const nestedUl = document.createElement('ul');
            nestedUl.classList.add('nested');

            // Appliquez la classe active si le dossier est ouvert
            if (li.isOpen) {
                nestedUl.classList.add('active');
            }

            li.appendChild(nestedUl);
            loadFilesAndFolders(item.contenu, nestedUl, itemPath, li.isOpen); // R√©cursion pour les sous-dossiers
        }
    });
}


// Fonction pour charger la structure des dossiers et fichiers depuis le serveur
async function loadFolderStructure() {
    try {
        const response = await fetch("/folder-structure");
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const folderStructure = await response.json();
        return folderStructure;
    } catch (error) {
        console.error("Erreur lors du chargement de la structure des dossiers :", error);
    }
}
// Fonction pour afficher la structure des dossiers et fichiers
function displayFolderStructure(folderStructure) {
    var fileExplorer = document.getElementById("fileExplorer");
    fileExplorer.innerHTML = ''; // Clear the file explorer
    loadFilesAndFolders(folderStructure, fileExplorer, '');
}

// Fonction pour charger le contenu d'un fichier
async function loadFileContent(filePath) {
    try {
        //requette vers backend + objet filePath pass√© dans l'url
        const response = await fetch(`/file-content?filePath=${filePath}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const fileContent = await response.text();
        console.log(fileContent, "aaaaaaaaaaaaa")
        const fileContentPre = document.getElementById("fileContent");
        fileContentPre.textContent = fileContent;
        fileContentPre.classList.add('file');
    } catch (error) {
        console.error("Erreur lors du chargement du contenu du fichier :", error);
    }
}
// Charger la structure des dossiers et fichiers au chargement de la page
window.onload = async function() {
    const folderStructure = await loadFolderStructure();
    if (folderStructure) {
        displayFolderStructure(folderStructure);
    } else {
        console.error("La structure des dossiers n'a pas pu √™tre charg√©e.");
    }
};
</script>

</body>
</html>
